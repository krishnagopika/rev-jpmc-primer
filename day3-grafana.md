# Grafana

### Variables


Variables in Grafana let you make dashboards dynamic. Instead of hardcoding a specific server or metric, you can pick it from a dropdown. e.g., filtering by server name.

Types of Variables in Grafana:

- **Query Variables**: Dynamically fetches values from a data source (e.g., list of servers)
- **Custom variables**: Lets you manually define a fixed list of options (e.g., "prod","dev","test").
- **Text Box**: Allows users to type in any value manually for filtering (free text input).
- **Constant**: Stores a single static value that doesnâ€™t change (used for hardcoded filters).
- **Data Source**: Lets you switch between different data sources in one dashboard (e.g., multiple Prometheus instances).
- **Interval Variables**: Defines time intervals (e.g., 1m, 5m, 1h) to use in panel queries or time ranges.


**Query Varibale - instance**

```
up{job="job_name"}
```


### Logging

Logging is the process of recording events, actions, or messages generated by an application during its execution. 


#### Levels


- `TRACE`: Most granular information for debugging deep issues. e.g. token validation succcefull
- `DEBUG`: Detailed information useful during development and troubleshooting. e.g.,  User registration started. User data username: 'john_doe', email: 'john.doe@example.com'
- `INFO`: Confirmation that things are working as expected, notable application events. e.g.,  User `john.doe` logged in successfully at 2025-05-07 XX:XX:XX.
- `WARN`: Indicates potential issues that don't prevent the application from working but may require attention. e.g., Disk space is running low. Only 10% available
- `ERROR`: Error events that might still allow the application to continue running, but functionality is impaired. e.g., Unable to fetch user profile data for userID: 12345.
- `FATAL`: any event that foces a shutdown of the service or application. e.g., Database connection failed, application shutting down immediately.



#### Loki configuration with Grafana

##### Promtail

- Promtail is an agent that ships logs to Loki, which is a log aggregation system.
- It also supports log parsing, relabeling, and log filtering to enhance the log data before it is sent to Loki.

##### Loki

- Loki is a horizontally scalable, highly available, multi-tenant log aggregation system designed by Grafana Labs.
- It stores logs in a way that is optimized for querying and visualizing in Grafana. 
- 


##### Dashboard


ERROR Logs

```
{job="fastapi-logs", app="fastapi"} |= "ERROR"
```

Log Count by severity per minute

```
sum by (level) (
  count_over_time({job="fastapi-logs"} |= "$level"[1m])
)
```

ERROR Logs in last 5 min

```
count_over_time({job="fastapi-logs"} |= "ERROR"[5m])
```

**references:**

1. [loki docs](https://grafana.com/docs/loki/latest/)
2. [promtail docs](https://grafana.com/docs/loki/latest/send-data/promtail/)


